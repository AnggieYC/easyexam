#!/usr/bin/env node
var util, path, fs, stdin, program, beautifyHtml, ref$, he, parse, HtmlGenerator, en, de, info, addStyle, that, macros, CustomMacros, options, readFile, input, dir, css, fonts, js, slice$ = [].slice, arrayFrom$ = Array.from || function(x){return slice$.call(x);};
global.window = require('svgdom');
global.document = window.document;
util = require('util');
path = require('path');
fs = require('fs-extra');
stdin = require('stdin');
program = require('commander');
beautifyHtml = require('js-beautify').html;
ref$ = require('../dist/latex.js'), he = ref$.he, parse = ref$.parse, HtmlGenerator = ref$.HtmlGenerator;
en = require('hyphenation.en-us');
de = require('hyphenation.de');
info = require('../package.json');
he.encode.options.strict = true;
he.encode.options.useNamedReferences = true;
addStyle = function(url, styles){
  if (!styles) {
    return [url];
  } else {
    return arrayFrom$(styles).concat([url]);
  }
};
program.name(info.name).version(info.version).description(info.description).usage('[options] [files...]').option('-o, --output <file>', 'specify output file, otherwise STDOUT will be used').option('-a, --assets [dir]', 'copy CSS and fonts to the directory of the output file, unless dir is given (default: no assets are copied)').option('-u, --url <base URL>', 'set the base URL to use for the assets (default: use relative URLs)').option('-b, --body', 'don\'t include HTML boilerplate and CSS, only output the contents of body').option('-e, --entities', 'encode HTML entities in the output instead of using UTF-8 characters').option('-p, --pretty', 'beautify the html (this may add/remove spaces unintentionally)').option('-c, --class <class>', 'set a default documentclass for documents without a preamble', 'article').option('-m, --macros <file>', 'load a JavaScript file with additional custom macros').option('-s, --stylesheet <url>', 'specify an additional style sheet to use (can be repeated)', addStyle).option('-n, --no-hyphenation', 'don\'t insert soft hyphens (disables automatic hyphenation in the browser)').option('-l, --language <lang>', 'set hyphenation language', 'en').on('--help', function(){
  return console.log('\nIf no input files are given, STDIN is read.');
}).parse(process.argv);
if (that = program.macros) {
  macros = path.resolve(process.cwd(), that);
  CustomMacros = require(macros);
  if (that = CustomMacros['default']) {
    CustomMacros = that;
  } else {
    CustomMacros = CustomMacros[path.parse(macros).name];
  }
}
if (program.body && (program.stylesheet || program.url)) {
  console.error("error: conflicting options: 'url' and 'stylesheet' cannot be used with 'body'!");
  process.exit(1);
}
options = {
  hyphenate: program.hyphenation,
  languagePatterns: (function(){
    switch (that = program.language) {
    case 'en':
      return en;
    case 'de':
      return de;
    default:
      console.error("error: language '" + that + "' is not supported yet");
      return process.exit(1);
    }
  }()),
  documentClass: program['class'],
  CustomMacros: CustomMacros,
  styles: program.style || []
};
readFile = util.promisify(fs.readFile);
if (program.args.length) {
  input = Promise.all(program.args.map(function(file){
    return readFile(file);
  }));
} else {
  input = new Promise(function(resolve, reject){
    stdin(function(str){
      resolve(str);
    });
  });
}
input.then(function(text){
  var generator, html;
  if (text.join) {
    text = text.join("\n\n");
  }
  generator = parse(text, {
    generator: new HtmlGenerator(options)
  });
  if (program.body) {
    html = generator.domFragment().outerHTML;
  } else {
    html = generator.htmlDocument(program.url).outerHTML;
  }
  if (program.entities) {
    html = he.encode(html, {
      'allowUnsafeSymbols': true
    });
  }
  if (program.pretty) {
    html = beautifyHtml(html, {
      'end_with_newline': true,
      'wrap_line_length': 120,
      'wrap_attributes': 'auto',
      'unformatted': ['span']
    });
  }
  if (program.output) {
    return fs.writeFileSync(program.output, html);
  } else {
    return process.stdout.write(html + '\n');
  }
})['catch'](function(err){
  console.error(err.toString());
  return process.exit(1);
});
dir = program.assets;
if (program.assets === true) {
  if (!program.output) {
    console.error("assets error: either a directory has to be given, or -o");
    process.exit(1);
  } else {
    dir = path.posix.dirname(path.resolve(program.output));
  }
} else if (fs.existsSync(dir) && !fs.statSync(dir).isDirectory()) {
  console.error("assets error: the given path exists but is not a directory: ", dir);
  process.exit(1);
}
if (dir) {
  css = path.join(dir, 'css');
  fonts = path.join(dir, 'fonts');
  js = path.join(dir, 'js');
  fs.mkdirpSync(css);
  fs.mkdirpSync(fonts);
  fs.mkdirpSync(js);
  fs.copySync(path.join(__dirname, '../dist/css'), css);
  fs.copySync(path.join(__dirname, '../dist/fonts'), fonts);
  fs.copySync(path.join(__dirname, '../dist/js'), js);
  fs.copySync(path.join(__dirname, '../node_modules/katex/dist/fonts/'), fonts, function(src){
    return /\.woff$/.exec(src) || fs.statSync(src).isDirectory();
  });
}
//# sourceMappingURL=data:application/json;base64,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LENBQUMsUUFBUSxJQUFJLENBQUMsUUFBUSxPQUFPLENBQUMsTUFBUixDQUFiOztDQUNqQyxNQUFBLElBQVEsRUFBRSxDQUFDLFVBQWdCLENBQUwsR0FBRCxDQUFNLENBQUEsRUFBQSxDQUFJLENBQUksRUFBRSxDQUFDLFFBQVAsQ0FBZ0IsR0FBRCxDQUFLLENBQUMsV0FBckIsQ0FBZ0MsQ0FBL0Q7RUFDSSxPQUFPLENBQUMsTUFBb0UsZ0VBQUUsR0FBRjtFQUM1RSxPQUFPLENBQUMsS0FBSyxDQUFBOztBQUVqQixJQUFHLEdBQUg7RUFDSSxHQUFJLENBQUEsQ0FBQSxDQUFFLElBQUksQ0FBQyxLQUFLLEtBQUssS0FBTDtFQUNoQixLQUFNLENBQUEsQ0FBQSxDQUFFLElBQUksQ0FBQyxLQUFLLEtBQUssT0FBTDtFQUNsQixFQUFHLENBQUEsQ0FBQSxDQUFFLElBQUksQ0FBQyxLQUFLLEtBQUssSUFBTDtFQUVmLEVBQUUsQ0FBQyxXQUFXLEdBQUE7RUFDZCxFQUFFLENBQUMsV0FBVyxLQUFBO0VBQ2QsRUFBRSxDQUFDLFdBQVcsRUFBQTtFQUVkLEVBQUUsQ0FBQyxTQUFVLElBQUksQ0FBQyxLQUFLLFdBQVcsYUFBWCxHQUEyQixHQUF0QztFQUNaLEVBQUUsQ0FBQyxTQUFVLElBQUksQ0FBQyxLQUFLLFdBQVcsZUFBWCxHQUE2QixLQUF4QztFQUNaLEVBQUUsQ0FBQyxTQUFVLElBQUksQ0FBQyxLQUFLLFdBQVcsWUFBWCxHQUEwQixFQUFyQztFQUNaLEVBQUUsQ0FBQyxTQUFVLElBQUksQ0FBQyxLQUFLLFdBQVcsbUNBQVgsR0FBaUQsT0FBTyxRQUFBLENBQUEsR0FBQTtXQUFnQixTQUFILENBQUEsSUFBQSxDQUFKLEdBQUksQ0FBYSxDQUFBLEVBQUEsQ0FBRyxFQUFFLENBQUMsUUFBTixDQUFlLEdBQUQsQ0FBSyxDQUFDLFdBQXBCLENBQStCO0dBQTVIIiwiZmlsZSI6ImNsaS5qcyIsInNvdXJjZXNDb250ZW50IjpbImBgIyEvdXNyL2Jpbi9lbnYgbm9kZWBgXG5cbiMgb24gdGhlIHNlcnZlciB3ZSBuZWVkIHRvIGluY2x1ZGUgYSBET00gaW1wbGVtZW50YXRpb24gLSBCRUZPUkUgcmVxdWlyaW5nIEh0bWxHZW5lcmF0b3IgYmVsb3dcbmdsb2JhbC53aW5kb3cgPSByZXF1aXJlICdzdmdkb20nXG5nbG9iYWwuZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnRcblxucmVxdWlyZSEge1xuICAgIHV0aWxcbiAgICBwYXRoXG4gICAgJ2ZzLWV4dHJhJzogZnNcbiAgICBzdGRpblxuICAgIGNvbW1hbmRlcjogcHJvZ3JhbVxuICAgICdqcy1iZWF1dGlmeSc6IHsgaHRtbDogYmVhdXRpZnktaHRtbCB9XG5cbiAgICAnLi4vZGlzdC9sYXRleC5qcyc6IHsgaGUsIHBhcnNlLCBIdG1sR2VuZXJhdG9yIH1cblxuICAgICdoeXBoZW5hdGlvbi5lbi11cyc6IGVuXG4gICAgJ2h5cGhlbmF0aW9uLmRlJzogICAgZGVcblxuICAgICcuLi9wYWNrYWdlLmpzb24nOiBpbmZvXG59XG5cbmhlLmVuY29kZS5vcHRpb25zLnN0cmljdCA9IHRydWVcbmhlLmVuY29kZS5vcHRpb25zLnVzZU5hbWVkUmVmZXJlbmNlcyA9IHRydWVcblxuYWRkU3R5bGUgPSAodXJsLCBzdHlsZXMpIC0+XG4gICAgaWYgbm90IHN0eWxlc1xuICAgICAgICBbdXJsXVxuICAgIGVsc2VcbiAgICAgICAgWy4uLnN0eWxlcywgdXJsXVxuXG5cbnByb2dyYW1cbiAgICAubmFtZSAgICAgICAgICAgaW5mby5uYW1lXG4gICAgLnZlcnNpb24gICAgICAgIGluZm8udmVyc2lvblxuICAgIC5kZXNjcmlwdGlvbiAgICBpbmZvLmRlc2NyaXB0aW9uXG5cbiAgICAudXNhZ2UgJ1tvcHRpb25zXSBbZmlsZXMuLi5dJ1xuXG5cbiAgICAub3B0aW9uICctbywgLS1vdXRwdXQgPGZpbGU+JywgICAgICAnc3BlY2lmeSBvdXRwdXQgZmlsZSwgb3RoZXJ3aXNlIFNURE9VVCB3aWxsIGJlIHVzZWQnXG4gICAgLm9wdGlvbiAnLWEsIC0tYXNzZXRzIFtkaXJdJywgICAgICAgJ2NvcHkgQ1NTIGFuZCBmb250cyB0byB0aGUgZGlyZWN0b3J5IG9mIHRoZSBvdXRwdXQgZmlsZSwgdW5sZXNzIGRpciBpcyBnaXZlbiAoZGVmYXVsdDogbm8gYXNzZXRzIGFyZSBjb3BpZWQpJ1xuICAgIC5vcHRpb24gJy11LCAtLXVybCA8YmFzZSBVUkw+JywgICAgICdzZXQgdGhlIGJhc2UgVVJMIHRvIHVzZSBmb3IgdGhlIGFzc2V0cyAoZGVmYXVsdDogdXNlIHJlbGF0aXZlIFVSTHMpJ1xuXG4gICAgIyBvcHRpb25zIGFmZmVjdGluZyB0aGUgSFRNTCBvdXRwdXRcbiAgICAub3B0aW9uICctYiwgLS1ib2R5JywgICAgICAgICAgICAgICAnZG9uXFwndCBpbmNsdWRlIEhUTUwgYm9pbGVycGxhdGUgYW5kIENTUywgb25seSBvdXRwdXQgdGhlIGNvbnRlbnRzIG9mIGJvZHknXG4gICAgLm9wdGlvbiAnLWUsIC0tZW50aXRpZXMnLCAgICAgICAgICAgJ2VuY29kZSBIVE1MIGVudGl0aWVzIGluIHRoZSBvdXRwdXQgaW5zdGVhZCBvZiB1c2luZyBVVEYtOCBjaGFyYWN0ZXJzJ1xuICAgIC5vcHRpb24gJy1wLCAtLXByZXR0eScsICAgICAgICAgICAgICdiZWF1dGlmeSB0aGUgaHRtbCAodGhpcyBtYXkgYWRkL3JlbW92ZSBzcGFjZXMgdW5pbnRlbnRpb25hbGx5KSdcblxuICAgICMgb3B0aW9ucyBhYm91dCBMYVRlWCBhbmQgc3R5bGVcbiAgICAub3B0aW9uICctYywgLS1jbGFzcyA8Y2xhc3M+JywgICAgICAnc2V0IGEgZGVmYXVsdCBkb2N1bWVudGNsYXNzIGZvciBkb2N1bWVudHMgd2l0aG91dCBhIHByZWFtYmxlJywgJ2FydGljbGUnXG4gICAgLm9wdGlvbiAnLW0sIC0tbWFjcm9zIDxmaWxlPicsICAgICAgJ2xvYWQgYSBKYXZhU2NyaXB0IGZpbGUgd2l0aCBhZGRpdGlvbmFsIGN1c3RvbSBtYWNyb3MnXG4gICAgLm9wdGlvbiAnLXMsIC0tc3R5bGVzaGVldCA8dXJsPicsICAgJ3NwZWNpZnkgYW4gYWRkaXRpb25hbCBzdHlsZSBzaGVldCB0byB1c2UgKGNhbiBiZSByZXBlYXRlZCknLCBhZGRTdHlsZVxuXG4gICAgLm9wdGlvbiAnLW4sIC0tbm8taHlwaGVuYXRpb24nLCAgICAgJ2RvblxcJ3QgaW5zZXJ0IHNvZnQgaHlwaGVucyAoZGlzYWJsZXMgYXV0b21hdGljIGh5cGhlbmF0aW9uIGluIHRoZSBicm93c2VyKSdcbiAgICAub3B0aW9uICctbCwgLS1sYW5ndWFnZSA8bGFuZz4nLCAgICAnc2V0IGh5cGhlbmF0aW9uIGxhbmd1YWdlJywgJ2VuJ1xuXG5cbiAgICAub24gJy0taGVscCcsIC0+IGNvbnNvbGUubG9nICdcXG5JZiBubyBpbnB1dCBmaWxlcyBhcmUgZ2l2ZW4sIFNURElOIGlzIHJlYWQuJ1xuXG4gICAgLnBhcnNlIHByb2Nlc3MuYXJndlxuXG5cblxuaWYgcHJvZ3JhbS5tYWNyb3NcbiAgICBtYWNyb3MgPSBwYXRoLnJlc29sdmUgcHJvY2Vzcy5jd2QhLCB0aGF0XG4gICAgQ3VzdG9tTWFjcm9zID0gKHJlcXVpcmUgbWFjcm9zKVxuICAgIGlmIEN1c3RvbU1hY3Jvcy5kZWZhdWx0XG4gICAgICAgICMgY2xhc3MgaXMgdGhlIGRlZmF1bHQgZXhwb3J0XG4gICAgICAgIEN1c3RvbU1hY3JvcyA9IHRoYXRcbiAgICBlbHNlXG4gICAgICAgICMgY2xhc3MgaXMgYSBuYW1lZCBleHBvcnRcbiAgICAgICAgQ3VzdG9tTWFjcm9zID0gQ3VzdG9tTWFjcm9zW3BhdGgucGFyc2UgbWFjcm9zIC5uYW1lXVxuXG5cbmlmIHByb2dyYW0uYm9keSBhbmQgKHByb2dyYW0uc3R5bGVzaGVldCBvciBwcm9ncmFtLnVybClcbiAgICBjb25zb2xlLmVycm9yIFwiZXJyb3I6IGNvbmZsaWN0aW5nIG9wdGlvbnM6ICd1cmwnIGFuZCAnc3R5bGVzaGVldCcgY2Fubm90IGJlIHVzZWQgd2l0aCAnYm9keSchXCJcbiAgICBwcm9jZXNzLmV4aXQgMVxuXG5cbmNvbnN0IG9wdGlvbnMgPVxuICAgIGh5cGhlbmF0ZTogICAgICAgICAgcHJvZ3JhbS5oeXBoZW5hdGlvblxuICAgIGxhbmd1YWdlUGF0dGVybnM6ICAgc3dpdGNoIHByb2dyYW0ubGFuZ3VhZ2VcbiAgICAgICAgICAgICAgICAgICAgICAgIHwgJ2VuJyA9PiBlblxuICAgICAgICAgICAgICAgICAgICAgICAgfCAnZGUnID0+IGRlXG4gICAgICAgICAgICAgICAgICAgICAgICB8IG90aGVyd2lzZSBjb25zb2xlLmVycm9yIFwiZXJyb3I6IGxhbmd1YWdlICcje3RoYXR9JyBpcyBub3Qgc3VwcG9ydGVkIHlldFwiOyBwcm9jZXNzLmV4aXQgMVxuICAgIGRvY3VtZW50Q2xhc3M6ICAgICAgcHJvZ3JhbS5jbGFzc1xuICAgIEN1c3RvbU1hY3JvczogICAgICAgQ3VzdG9tTWFjcm9zXG4gICAgc3R5bGVzOiAgICAgICAgICAgICBwcm9ncmFtLnN0eWxlIHx8IFtdXG5cblxuXG5cblxuY29uc3QgcmVhZEZpbGUgPSB1dGlsLnByb21pc2lmeShmcy5yZWFkRmlsZSlcblxuaWYgcHJvZ3JhbS5hcmdzLmxlbmd0aFxuICAgIGlucHV0ID0gUHJvbWlzZS5hbGwgcHJvZ3JhbS5hcmdzLm1hcCAoZmlsZSkgLT4gcmVhZEZpbGUgZmlsZVxuZWxzZVxuICAgIGlucHV0ID0gbmV3IFByb21pc2UgKHJlc29sdmUsIHJlamVjdCkgIS0+IHN0ZGluIChzdHIpICEtPiByZXNvbHZlIHN0clxuXG5cbmlucHV0LnRoZW4gKHRleHQpIC0+XG4gICAgaWYgdGV4dC5qb2luXG4gICAgICAgIHRleHQgPSB0ZXh0LmpvaW4gXCJcXG5cXG5cIlxuXG4gICAgZ2VuZXJhdG9yID0gcGFyc2UgdGV4dCwgeyBnZW5lcmF0b3I6IG5ldyBIdG1sR2VuZXJhdG9yKG9wdGlvbnMpIH1cblxuICAgIGlmIHByb2dyYW0uYm9keVxuICAgICAgICBodG1sID0gZ2VuZXJhdG9yLmRvbUZyYWdtZW50IS5vdXRlckhUTUxcbiAgICBlbHNlXG4gICAgICAgIGh0bWwgPSBnZW5lcmF0b3IuaHRtbERvY3VtZW50KHByb2dyYW0udXJsKS5vdXRlckhUTUxcblxuICAgIGlmIHByb2dyYW0uZW50aXRpZXNcbiAgICAgICAgaHRtbCA9IGhlLmVuY29kZSBodG1sLCAnYWxsb3dVbnNhZmVTeW1ib2xzJzogdHJ1ZVxuXG4gICAgaWYgcHJvZ3JhbS5wcmV0dHlcbiAgICAgICAgaHRtbCA9IGJlYXV0aWZ5LWh0bWwgaHRtbCxcbiAgICAgICAgICAgICdlbmRfd2l0aF9uZXdsaW5lJzogdHJ1ZVxuICAgICAgICAgICAgJ3dyYXBfbGluZV9sZW5ndGgnOiAxMjBcbiAgICAgICAgICAgICd3cmFwX2F0dHJpYnV0ZXMnIDogJ2F1dG8nXG4gICAgICAgICAgICAndW5mb3JtYXR0ZWQnOiBbJ3NwYW4nXVxuXG4gICAgaWYgcHJvZ3JhbS5vdXRwdXRcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyBwcm9ncmFtLm91dHB1dCwgaHRtbFxuICAgIGVsc2VcbiAgICAgICAgcHJvY2Vzcy5zdGRvdXQud3JpdGUgaHRtbCArICdcXG4nXG4uY2F0Y2ggKGVycikgLT5cbiAgICBjb25zb2xlLmVycm9yIGVyci50b1N0cmluZyFcbiAgICBwcm9jZXNzLmV4aXQgMVxuXG5cbiMgYXNzZXRzXG5kaXIgPSBwcm9ncmFtLmFzc2V0c1xuXG5pZiBwcm9ncmFtLmFzc2V0cyA9PSB0cnVlXG4gICAgaWYgbm90IHByb2dyYW0ub3V0cHV0XG4gICAgICAgIGNvbnNvbGUuZXJyb3IgXCJhc3NldHMgZXJyb3I6IGVpdGhlciBhIGRpcmVjdG9yeSBoYXMgdG8gYmUgZ2l2ZW4sIG9yIC1vXCJcbiAgICAgICAgcHJvY2Vzcy5leGl0IDFcbiAgICBlbHNlXG4gICAgICAgIGRpciA9IHBhdGgucG9zaXguZGlybmFtZSBwYXRoLnJlc29sdmUgcHJvZ3JhbS5vdXRwdXRcbmVsc2UgaWYgZnMuZXhpc3RzU3luYyhkaXIpIGFuZCBub3QgZnMuc3RhdFN5bmMoZGlyKS5pc0RpcmVjdG9yeSFcbiAgICBjb25zb2xlLmVycm9yIFwiYXNzZXRzIGVycm9yOiB0aGUgZ2l2ZW4gcGF0aCBleGlzdHMgYnV0IGlzIG5vdCBhIGRpcmVjdG9yeTogXCIsIGRpclxuICAgIHByb2Nlc3MuZXhpdCAxXG5cbmlmIGRpclxuICAgIGNzcyA9IHBhdGguam9pbiBkaXIsICdjc3MnXG4gICAgZm9udHMgPSBwYXRoLmpvaW4gZGlyLCAnZm9udHMnXG4gICAganMgPSBwYXRoLmpvaW4gZGlyLCAnanMnXG5cbiAgICBmcy5ta2RpcnBTeW5jIGNzc1xuICAgIGZzLm1rZGlycFN5bmMgZm9udHNcbiAgICBmcy5ta2RpcnBTeW5jIGpzXG5cbiAgICBmcy5jb3B5U3luYyAocGF0aC5qb2luIF9fZGlybmFtZSwgJy4uL2Rpc3QvY3NzJyksIGNzc1xuICAgIGZzLmNvcHlTeW5jIChwYXRoLmpvaW4gX19kaXJuYW1lLCAnLi4vZGlzdC9mb250cycpLCBmb250c1xuICAgIGZzLmNvcHlTeW5jIChwYXRoLmpvaW4gX19kaXJuYW1lLCAnLi4vZGlzdC9qcycpLCBqc1xuICAgIGZzLmNvcHlTeW5jIChwYXRoLmpvaW4gX19kaXJuYW1lLCAnLi4vbm9kZV9tb2R1bGVzL2thdGV4L2Rpc3QvZm9udHMvJyksIGZvbnRzLCAoc3JjKSAtPiBzcmMgPT0gL1xcLndvZmYkLyBvciBmcy5zdGF0U3luYyhzcmMpLmlzRGlyZWN0b3J5IVxuIl19
